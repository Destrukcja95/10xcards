---
import Layout from "@/layouts/Layout.astro";
import { ProfileView } from "@/components/profile";

// Sprawdź czy użytkownik jest zalogowany
const {
  data: { user },
  error,
} = await Astro.locals.supabase.auth.getUser();

console.log('[profile.astro] getUser result - user:', user?.email, 'error:', error?.message);

// Redirect niezalogowanych użytkowników do strony logowania
if (!user) {
  console.log('[profile.astro] No user, redirecting to /auth');
  return Astro.redirect("/auth?returnUrl=/profile");
}

console.log('[profile.astro] User authenticated:', user.email);
---

<Layout title="Profil - 10x-cards" description="Zarządzaj swoim profilem i przeglądaj statystyki nauki">
  <div class="min-h-screen bg-background">
    <header class="sticky top-0 z-50 border-b border-border/40 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
      <nav class="container mx-auto flex h-16 items-center justify-between px-4">
        <a href="/" class="text-xl font-bold text-foreground hover:text-primary transition-colors">
          10x-cards
        </a>
        <div class="flex items-center gap-6">
          <a 
            href="/generate" 
            class="text-sm text-muted-foreground hover:text-foreground transition-colors"
          >
            Generuj fiszki
          </a>
          <a 
            href="/flashcards" 
            class="text-sm text-muted-foreground hover:text-foreground transition-colors"
          >
            Moje fiszki
          </a>
          <a 
            href="/study" 
            class="text-sm text-muted-foreground hover:text-foreground transition-colors"
          >
            Sesja nauki
          </a>
          <a 
            href="/profile" 
            class="text-sm font-medium text-foreground"
            aria-current="page"
          >
            Profil
          </a>
          <form action="/api/auth/logout" method="POST">
            <button 
              type="submit"
              class="text-sm text-muted-foreground hover:text-foreground transition-colors"
            >
              Wyloguj się
            </button>
          </form>
        </div>
      </nav>
    </header>

    <main>
      <ProfileView client:load userEmail={user.email} />
    </main>
  </div>
</Layout>

